{% extends 'main.html' %}

{% block headers %}
<link rel="stylesheet" href="/static/css/jqcloud.min.css">
<script src="/static/js/dataTables.min.js"></script>
<script src="/static/js/jqcloud.min.js"></script>
{% endblock %}

{% block content %}
{% if wordcloud_file_name %}
    <img id="wordcloud_image" style="width:100%;" src="/static/wc/{{ wordcloud_file_name }}">
{% endif %}

{% if word_statistics_json %}
    <div id="wordcloud_javascript" style="margin:auto;width:80%;height:900px;"></div>
    <script>
        var words = {{ word_statistics_json | tojson | safe }};
        for (var i = 0; i < words.length; i++) {
            words[i].afterWordRender = function() {
                var link = document.createElement('a');
                link.innerHTML = this.text();
                link.href = "https://www.ncbi.nlm.nih.gov/pubmed/?term=" + this.text();
                this.empty().append(link);
            }

            /*words[i].handlers = {
                click: function() {
                    var keyWord = $(this).text()
                    location.href =
                    //alert($(this).text())
                }
            }*/
        };
        var maxWeight = Math.max.apply(Math, words.map(function(word) { return word.weight; }));
        var minSize = 10;
        $("#wordcloud_javascript").jQCloud(words, {
            autoResize: true,
            steps: maxWeight,
            fontSize: function(width, height, step) {
                var maxSize = height / 3;
                return maxSize * step / maxWeight;
                //var trueSize = maxSize * step / maxWeight;
                //if (trueSize >= minSize) { return trueSize; }
                //else {return minSize; }
            },
            classPattern: "w{n} btn",
        });
    </script>
{% endif %}

{% if graph_json %}
    {% include 'graph.html' %}
{% endif %}

    <div style="float:left;clear:left;" class="btn-group">
        <!--<a class="btn btn-default">Link to Articles Citing RSID's</a>-->
        <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Links to Articles Citing RSID's<span class="caret"></span></a>
        <ul class="dropdown-menu">
            {% for rsid in pmid_data %}
                <li>
                    <a href="https://www.ncbi.nlm.nih.gov/pubmed/?term={% for pmid in pmid_data[rsid] %}{{ pmid }}+{% endfor %}">
                        rs{{ rsid }} ({{ pmid_data[rsid] | length }})
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
    {% include 'word_statistics_table.html' %}
{% endblock %}